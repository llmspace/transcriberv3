flowchart LR
    Start([User Pastes<br/>YouTube URL]) --> Parse[Parse &<br/>Validate URL]
    Parse --> CheckDupe{Already<br/>Transcribed?}
    CheckDupe -->|Yes| Skip[Skip<br/>SKIPPED]
    CheckDupe -->|No| Metadata[Fetch Video<br/>Metadata<br/>yt-dlp]
    
    Metadata --> TryCaptions{Creator<br/>Captions<br/>Available?}
    
    TryCaptions -->|Yes| CaptionPath[CAPTION PATH]
    CaptionPath --> FetchCaptions[Download<br/>VTT Captions<br/>yt-dlp]
    FetchCaptions --> ParseVTT[Parse VTT<br/>to Plain Text]
    ParseVTT --> WriteOutput[Write<br/>Transcript<br/>File]
    
    TryCaptions -->|No| AudioPath[DEEPGRAM PATH]
    
    AudioPath --> SelectStream[Select Audio<br/>Stream<br/>96kbps target]
    SelectStream --> Download[Download<br/>Audio<br/>yt-dlp]
    Download --> Normalize[Normalize<br/>Audio<br/>mono 16kHz]
    
    Normalize --> CheckDuration{Duration<br/>> 2hrs?}
    CheckDuration -->|No| Transcribe[Transcribe<br/>Deepgram<br/>Nova-3]
    CheckDuration -->|Yes| Chunk[Split into<br/>Chunks<br/>with overlap]
    
    Chunk --> TranscribeChunks[Transcribe<br/>Each Chunk<br/>Deepgram]
    TranscribeChunks --> Merge[Merge<br/>Chunks<br/>dedupe]
    
    Transcribe --> WriteOutput
    Merge --> WriteOutput
    
    WriteOutput --> Cleanup[Cleanup<br/>Audio Files]
    Cleanup --> Done([Transcript<br/>Saved])
    
    Skip --> Done
    
    style Start fill:#e1f5ff
    style Done fill:#d4edda
    style Skip fill:#fff3cd
    style AudioPath fill:#f8d7da
    style CaptionPath fill:#d1ecf1
    style TryCaptions fill:#cfe2ff
    style WriteOutput fill:#d1ecf1
